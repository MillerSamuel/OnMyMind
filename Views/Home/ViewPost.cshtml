@{
    ViewData["Title"] = "Post";
    bool alreadyFollowing = false;
    bool alreadyLiked = false;
}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<partial name="_Header"></partial>
@model Comment

<body>
    <div class="container ">
        <div class="feed">
            @foreach (Connection c in ViewBag.LoggedUser.Following)
            {
                @foreach (Post p in c.UserFollowed.CreatedPosts)
                {
                    if (p.PostId == ViewBag.Post.PostId)
                    {
                        @foreach (Like l in ViewBag.LoggedUser.Likes)
                        {
                            if (l.PostId == p.PostId)
                            {
                                alreadyLiked = true;
                            }
                        }
                        if (alreadyLiked)
                        {
                            <div class="post m-top white">
                                <div class="d-flex  align-items-center white">
                                    <img class="postimg" src="~/images/ProfilePic.jpg" alt="">
                                    <p class="white"><a class="name f-15 white" href="/Profile/@c.UserFollowed.UserId">
                                            @c.UserFollowed.FirstName @c.UserFollowed.LastName</a></p>
                                </div>
                                <p class="white f-15">@p.PostText </p>
                                <p class="white f-15">@p.CreatedAt.ToShortDateString() @p.CreatedAt.ToShortTimeString() <a class="white"
                        href="/Unlike/@p.PostId">Un-Like</a></p>
                                @if (p.Likes.Count() == 1)
                                {
                                    <p class="f-15 white">@p.Likes.Count() like</p>
                                }
                                else
                                {
                                    <p class="f-15 white">@p.Likes.Count() likes</p>
                                }
                                <p style="text-decoration: underline;" class="white">Comments</p>
                                @foreach (Comment comment in ViewBag.Post.Comments)
                                {
                                    <p class="white">@comment.UserCommenting.FirstName @comment.UserCommenting.LastName: @comment.CommentText</p>
                                }
                                <form class="white white2" action="/postComment" method="post">
                                    <input asp-for="CommentText">
                                    <span asp-validation-for="CommentText"></span>
                                    <input asp-for="UserId" hidden value="@ViewBag.LoggedUser.UserId">
                                    <input asp-for="PostId" hidden value="@p.PostId">
                                    <input style="margin-bottom: 15px;" type="submit" value="Send Comment">
                                </form>
                            </div>
                        }
                        else
                        {
                            <div class="post m-top white">
                                <div class="d-flex align-items-center white">
                                    <img class="postimg" src="~/images/ProfilePic.jpg" alt="">
                                    <p class="white"><a class="f-15 name white" href="/Profile/@c.UserFollowed.UserId">
                                            @c.UserFollowed.FirstName @c.UserFollowed.LastName</a> </p>
                                </div>
                                <p class="f-15 white">@p.PostText</p>
                                <p class="f-15 white">@p.CreatedAt.ToShortDateString() @p.CreatedAt.ToShortTimeString() <a class="white"
                        href="/Like/@p.PostId">Like</a></p>
                                @if (p.Likes.Count() == 1)
                                {
                                    <p class="f-15 white">@p.Likes.Count() like</p>
                                }
                                else
                                {
                                    <p class="f-15 white">@p.Likes.Count() likes</p>
                                }
                                <p style="text-decoration: underline;" class="white">Comments</p>
                                @foreach (Comment comment in ViewBag.Post.Comments)
                                {
                                    <p class="white">@comment.UserCommenting.FirstName @comment.UserCommenting.LastName:
                                        @comment.CommentText</p>
                                }
                                <form class="white white2" action="/postComment" method="post">
                                    <input asp-for="CommentText">
                                    <input asp-for="UserId" hidden value="@ViewBag.LoggedUser.UserId">
                                    <input asp-for="PostId" hidden value="@p.PostId">
                                    <input style="margin-bottom: 15px;" type="submit" value="Send Comment">
                                </form>
                            </div>
                        }
                        {
                            alreadyLiked = false;
                        }
                    }
                }
            }
        </div>
    </div>
    </div>
</body>

</html>